<!--
  PWA SPLASH SCREEN
  - Script inline no topo impede flash de conteúdo
  - sessionStorage garante que aparece SÓ na abertura do app
-->
<script>
    // Se já mostrou nesta sessão, nem renderiza o splash
    if (sessionStorage.getItem('splashDone')) {
        document.currentScript.dataset.skip = '1';
    }
</script>

<template id="splashTemplate">
<div id="splashScreen" class="splash-screen">
    <div class="splash-particles">
        <div class="particle"></div><div class="particle"></div>
        <div class="particle"></div><div class="particle"></div>
        <div class="particle"></div><div class="particle"></div>
        <div class="particle"></div><div class="particle"></div>
    </div>

    <div class="splash-rings">
        <div class="ring ring-1"></div>
        <div class="ring ring-2"></div>
        <div class="ring ring-3"></div>
    </div>

    <div class="splash-logo-wrapper">
        <div class="splash-glow"></div>
        {% if condominio_atual and condominio_atual.logo %}
        <img src="{{ condominio_atual.logo.url }}" alt="{{ condominio_atual.nome }}" class="splash-logo">
        {% else %}
        <img src="/static/img/icon-192.png" alt="Splash RC" class="splash-logo">
        {% endif %}
    </div>

    <div class="splash-text">
        <h1 class="splash-title">{% if condominio_atual %}{{ condominio_atual.nome }}{% else %}Splash Residence Club{% endif %}</h1>
        <p class="splash-subtitle">{% if condominio_atual %}Condomínio{% else %}Club{% endif %}</p>
    </div>

    <div class="splash-loader">
        <div class="splash-loader-bar"></div>
    </div>
</div>
</template>

<script>
(function() {
    // Pula se já mostrou nesta sessão
    var scripts = document.querySelectorAll('script');
    var marker = document.querySelector('script[data-skip]');
    if (marker && marker.dataset.skip === '1') return;

    // Marca que já mostrou — NÃO mostrará nas próximas páginas
    sessionStorage.setItem('splashDone', '1');

    // Injeta o splash do template
    var tpl = document.getElementById('splashTemplate');
    var splash = tpl.content.cloneNode(true);
    document.body.prepend(splash);

    // Esconde o conteúdo real até o splash terminar
    document.body.style.overflow = 'hidden';

    // PWA standalone = 3s, navegador = 2.2s
    var isStandalone = window.matchMedia('(display-mode: standalone)').matches
                    || window.navigator.standalone === true;
    var duration = isStandalone ? 3000 : 2200;

    setTimeout(function() {
        var el = document.getElementById('splashScreen');
        if (el) {
            el.classList.add('fade-out');
            setTimeout(function() {
                el.remove();
                document.body.style.overflow = '';
            }, 600);
        }
    }, duration);
})();
</script>

<style>
    .splash-screen {
        position: fixed;
        inset: 0;
        z-index: 99999;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background: linear-gradient(135deg, #0f172a 0%, #1e3a5f 40%, #2563eb 100%);
        overflow: hidden;
        opacity: 1;
        transition: opacity 0.6s cubic-bezier(0.4, 0, 0.2, 1),
                    transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .splash-screen.fade-out {
        opacity: 0;
        transform: scale(1.08);
        pointer-events: none;
    }

    /* === PARTÍCULAS === */
    .splash-particles { position: absolute; inset: 0; overflow: hidden; }

    .particle {
        position: absolute;
        width: 6px; height: 6px;
        background: rgba(255,255,255,0.15);
        border-radius: 50%;
        animation: particleFloat 6s ease-in-out infinite;
    }
    .particle:nth-child(1) { left: 10%; top: 20%; animation-delay: 0s; animation-duration: 5s; }
    .particle:nth-child(2) { left: 25%; top: 60%; animation-delay: 1s; animation-duration: 7s; width: 4px; height: 4px; }
    .particle:nth-child(3) { left: 50%; top: 15%; animation-delay: 2s; animation-duration: 6s; width: 8px; height: 8px; }
    .particle:nth-child(4) { left: 70%; top: 70%; animation-delay: .5s; animation-duration: 8s; }
    .particle:nth-child(5) { left: 85%; top: 30%; animation-delay: 3s; animation-duration: 5.5s; width: 5px; height: 5px; }
    .particle:nth-child(6) { left: 40%; top: 80%; animation-delay: 1.5s; animation-duration: 7s; width: 3px; height: 3px; }
    .particle:nth-child(7) { left: 60%; top: 45%; animation-delay: 2.5s; animation-duration: 6.5s; width: 7px; height: 7px; }
    .particle:nth-child(8) { left: 15%; top: 50%; animation-delay: .8s; animation-duration: 5.8s; }

    @keyframes particleFloat {
        0%, 100% { transform: translateY(0) translateX(0) scale(1); opacity: .2; }
        25% { transform: translateY(-30px) translateX(10px) scale(1.2); opacity: .5; }
        50% { transform: translateY(-15px) translateX(-15px) scale(.8); opacity: .3; }
        75% { transform: translateY(-40px) translateX(5px) scale(1.1); opacity: .6; }
    }

    /* === ANÉIS === */
    .splash-rings {
        position: absolute;
        width: 300px; height: 300px;
        display: flex; align-items: center; justify-content: center;
    }
    .ring {
        position: absolute; border-radius: 50%;
        border: 1.5px solid rgba(255,255,255,0.08);
    }
    .ring-1 { width: 160px; height: 160px; animation: ringPulse 3s ease-in-out infinite; }
    .ring-2 { width: 220px; height: 220px; animation: ringPulse 3s ease-in-out .5s infinite; }
    .ring-3 { width: 280px; height: 280px; animation: ringPulse 3s ease-in-out 1s infinite; }

    @keyframes ringPulse {
        0%, 100% { transform: scale(.9); opacity: .3; border-color: rgba(255,255,255,.05); }
        50% { transform: scale(1.1); opacity: .8; border-color: rgba(59,130,246,.3); }
    }

    /* === LOGO === */
    .splash-logo-wrapper {
        position: relative;
        animation: logoEntrance .8s cubic-bezier(.34,1.56,.64,1) .2s forwards;
        opacity: 0;
    }
    .splash-glow {
        position: absolute; inset: -20px;
        background: radial-gradient(circle, rgba(59,130,246,.4) 0%, transparent 70%);
        border-radius: 50%;
        animation: glowPulse 2s ease-in-out infinite;
        filter: blur(15px);
    }
    .splash-logo {
        width: 100px; height: 100px;
        border-radius: 24px;
        object-fit: contain;
        position: relative; z-index: 2;
        background: rgba(255,255,255,.1);
        backdrop-filter: blur(10px);
        padding: 12px;
        border: 1.5px solid rgba(255,255,255,.15);
        box-shadow: 0 20px 60px rgba(0,0,0,.3), 0 0 40px rgba(59,130,246,.2);
    }

    @keyframes logoEntrance {
        0% { opacity: 0; transform: scale(.3) translateY(20px); }
        100% { opacity: 1; transform: scale(1) translateY(0); }
    }
    @keyframes glowPulse {
        0%, 100% { opacity: .5; transform: scale(1); }
        50% { opacity: 1; transform: scale(1.15); }
    }

    /* === TEXTO === */
    .splash-text {
        text-align: center; margin-top: 28px;
        animation: textEntrance .7s cubic-bezier(.34,1.56,.64,1) .6s forwards;
        opacity: 0;
    }
    .splash-title {
        font-family: 'Plus Jakarta Sans','Inter',system-ui,sans-serif;
        font-weight: 800; font-size: 1.6rem; color: white;
        letter-spacing: -.5px; margin: 0; line-height: 1.2;
    }
    .splash-subtitle {
        font-family: 'Plus Jakarta Sans','Inter',system-ui,sans-serif;
        font-weight: 600; font-size: 1rem;
        color: rgba(147,197,253,.8);
        letter-spacing: 6px; text-transform: uppercase;
        margin: 4px 0 0;
    }
    @keyframes textEntrance {
        0% { opacity: 0; transform: translateY(15px); }
        100% { opacity: 1; transform: translateY(0); }
    }

    /* === LOADING BAR === */
    .splash-loader {
        position: absolute; bottom: 80px;
        width: 140px; height: 3px;
        background: rgba(255,255,255,.1);
        border-radius: 10px; overflow: hidden;
        animation: loaderEntrance .5s ease 1s forwards;
        opacity: 0;
    }
    .splash-loader-bar {
        height: 100%; width: 0%;
        background: linear-gradient(90deg, #3b82f6, #60a5fa, #93c5fd);
        border-radius: 10px;
        animation: loaderProgress 1.8s cubic-bezier(.4,0,.2,1) 1.1s forwards;
        box-shadow: 0 0 10px rgba(59,130,246,.5);
    }
    @keyframes loaderEntrance { 0% { opacity: 0; } 100% { opacity: 1; } }
    @keyframes loaderProgress {
        0% { width: 0%; } 30% { width: 40%; } 60% { width: 70%; } 100% { width: 100%; }
    }
</style>
