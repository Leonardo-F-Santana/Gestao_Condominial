{% extends 'sindico/base_sindico.html' %}

{% block title %}Painel — {{ condominio.nome }}{% endblock %}

{% block content %}
<div class="page-header d-flex justify-content-between align-items-center">
    <div>
        <h1 class="page-title">{{ condominio.nome }}</h1>
        <p class="page-subtitle">Visão geral do condomínio</p>
    </div>
</div>

<!-- Stats -->
<div class="stat-row" style="grid-template-columns: 1fr 1fr;">
    <div class="stat-card blue">
        <div class="stat-value">{{ stats.moradores }}</div>
        <div class="stat-label">Moradores</div>
    </div>
    <div class="stat-card green">
        <div class="stat-value">{{ stats.solicitacoes_pendentes }}</div>
        <div class="stat-label">Solicitações</div>
    </div>
</div>

<!-- Panorama Financeiro -->
<div class="card-section mt-4">
    <div class="card-section-header d-flex justify-content-between">
        <span class="card-section-title"><i class="bi bi-wallet2"></i> Saúde Financeira</span>
        <a href="{% url 'sindico_financeiro' %}" class="text-decoration-none" style="font-size: 0.72rem; color: var(--blue); font-weight: 600;">Ver cobranças →</a>
    </div>
    <div class="card-section-body text-center p-3" style="max-height: 300px; position: relative;">
        <!-- Canvas do Chart.js -->
        <canvas id="financeChart"></canvas>
    </div>
</div>



<!-- Solicitações Recentes -->
<div class="card-section">
    <div class="card-section-header">
        <span class="card-section-title"><i class="bi bi-clipboard"></i> Solicitações</span>
        <a href="{% url 'sindico_solicitacoes' %}" class="text-decoration-none" style="font-size: 0.72rem; color: var(--blue); font-weight: 600;">Ver todas →</a>
    </div>
    <div class="card-section-body">
        {% for s in ultimas_solicitacoes %}
        <div class="list-row">
            <div>
                <div class="list-row-name">{{ s.get_tipo_display }}</div>
                <div class="list-row-sub">{{ s.morador.nome|default:"Anônimo"|truncatechars:20 }}</div>
            </div>
            <span class="badge-status {% if s.status == 'PENDENTE' %}badge-pendente{% elif s.status == 'CONCLUIDO' %}badge-concluido{% elif s.status == 'EM_ANDAMENTO' %}badge-andamento{% else %}badge-cancelado{% endif %}">
                {{ s.get_status_display }}
            </span>
        </div>
        {% empty %}
        <div class="empty-state">
            <div class="empty-state-icon"><i class="bi bi-clipboard"></i></div>
            <div class="empty-state-text">Nenhuma solicitação</div>
        </div>
        {% endfor %}
    </div>
</div>
</div>

<!-- Importando Chart.js via CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
document.addEventListener("DOMContentLoaded", function() {
    var ctx = document.getElementById('financeChart').getContext('2d');
    var financeChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: ['Pagas', 'Pendentes', 'Atrasadas'],
            datasets: [{
                data: [
                    {{ stats.cobrancas_pagas|default:0 }},
                    {{ stats.cobrancas_pendentes|default:0 }},
                    {{ stats.cobrancas_atrasadas|default:0 }}
                ],
                backgroundColor: [
                    '#10b981', // Verde (Pagas)
                    '#f59e0b', // Laranja (Pendentes)
                    '#ef4444'  // Vermelho (Atrasadas)
                ],
                borderWidth: 0,
                hoverOffset: 4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        font: {
                            family: "'Inter', sans-serif"
                        }
                    }
                }
            }
        }
    });
});
</script>
{% endblock %}
